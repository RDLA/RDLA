
<% ((player_connected.posy-player_connected.visual_acuity)..(player_connected.posy+player_connected.visual_acuity)).each do|y| %>
      <% ((player_connected.posx-player_connected.visual_acuity)..(player_connected.posx+player_connected.visual_acuity)).each do|x| %>
          
          <% if fields["#{x};#{y}"].blank?  %>
              <% css_for_field = "field#{player_connected.map.default_field_id}" %>
          <% else %>
              <% css_for_field = "field#{fields["#{x};#{y}"].field_id}" %>
          <% end %>
          
          <% if !buildings["#{x};#{y}"].blank?%>
           <% building = buildings["#{x};#{y}"] %>
           <% css_for_field = "#{css_for_field} building" %>
           <div id="building<%= building.id %>" class="<%= css_for_field  %>">
            <%= image_tag("/assets/buildings/#{building.icon_url}", :title => building.name) %>
           </div>
          <% elsif !players["#{x};#{y}"].blank? %>
            <% player = players["#{x};#{y}"] %>
            <% css_for_field = "#{css_for_field} player" %>
            <div id="player<%= player.id %>" class="<%= css_for_field  %>">
            <%= image_tag("/assets/icons/rabbit.png", :title => player.name) %>
           </div>
          <% else %>
            <div id="pos<%= "#{x}I#{y}" %>" class="<%= css_for_field  %>"></div>
          <% end %>
       
      <% end %>
    <% end %>